name: Mod Organizer 2 - Fallout New Vegas
game_slug: mod-organizer-2
slug: mod-organizer-2
version: 2.2.2.1 for Fallout New Vegas
runner: linux

script:
    requires: fallout-new-vegas

    files:
    - proton_launcher: https://github.com/rockerbacon/lutris-skyrimse-installers/releases/download/2.1/proton_launcher.sh
    - nxm_broker: https://github.com/rockerbacon/lutris-skyrimse-installers/releases/download/2.1/modorganizer2-nxm-broker.sh
    - nxm_mime_handler: https://github.com/rockerbacon/lutris-skyrimse-installers/releases/download/2.1/modorganizer2-nxm-handler.desktop
    - readme: https://github.com/rockerbacon/lutris-skyrimse-installers/releases/download/2.1/modorganizer2_newvegas.README
    - nvse_dll: http://nvse.silverlock.org/download/nvse_5_1_beta4.7z
    - mo_archive: https://github.com/ModOrganizer2/modorganizer/releases/download/v2.2.2.1/Mod.Organizer-2.2.2.1.7z
    - openjdk: https://github.com/AdoptOpenJDK/openjdk8-upstream-binaries/releases/download/jdk8u252-b09/OpenJDK8U-jre_x64_windows_8u252b09.zip

    game:
        exe: $GAMEDIR/proton_launcher.sh
        args: >-
            --restart-pulse
            --native 'd3dx9_42'
            --protonver '5.*'
            22380 ModOrganizer2/ModOrganizer.exe

    installer:
    - input_menu:
        description: |-
            IMPORTANT!!!

            Make sure your game is configured to use Proton 5.0 on Steam. You can do so by right clicking on
            it > Properties > Force the use of a specific Steam Play compatibility tool.

            This installer expects Steam to have performed first time setup, so make sure Fallout New Vegas
            was launched on Steam at least once before proceeding with the installation.

            Mod Organizer 2 will not be able to open a browser. In order to connect to your Nexus account,
            manually add the API key you got at https://www.nexusmods.com/users/myaccount?tab=api%20access

            In order to run Mod Organizer 2, Steam must also be running. If you do not receive
            warnings when attempting to launch Mod Organizer 2 before Steam, make sure either
            zenity or xmessage or xterm are installed on your system.

            This installer contains NVSE 5.1b4 and tweaks which allow usage of ENBs.
            In-game ENB commands such as toggle effects, open editor, etc will not work, however.

            When adding Proc Patchers, use the included binary located in "C:\java\bin\java.exe".
            Adding the argument "-Dsun.java2d.d3d=false" to Proc Patchers might fix blank screen issues.

            If uninstalling Mod Organizer 2, untick the option to remove data files in Lutris.
            This option will removed all game files, not just files added by this installer.

            In case of questions or issues visit https://github.com/rockerbacon/lutris-skyrimse-installers

            The contents of this message will be available on 'modorganizer2_newvegas.README',
            inside the game's install directory

        options:
            - waiting: Click here after reading everything
            - proceed: I'm ready to continue with the installation
        preselect: waiting

    - copy:
        src: readme
        dst: $GAMEDIR/

    - copy:
        src: proton_launcher
        dst: $GAMEDIR/
    - chmodx: $GAMEDIR/proton_launcher.sh

    - copy:
        src: nxm_broker
        dst: $HOME/.local/bin
    - chmodx: $HOME/.local/bin/modorganizer2-nxm-broker.sh

    - copy:
        src: nxm_mime_handler
        dst: $HOME/.local/share/applications
    - execute:
        command: xdg-mime default modorganizer2-nxm-handler.desktop x-scheme-handler/nxm
    - execute:
        command: xdg-mime default modorganizer2-nxm-handler.desktop x-scheme-handler/nxm-protocol

    - extract:
        file: openjdk
        dst: $GAMEDIR/../../compatdata/22380/pfx/drive_c/java

    - extract:
        file: nvse_dll
        dst: $GAMEDIR/

    - extract:
        file: mo_archive
        dst: $GAMEDIR/ModOrganizer2/

    - execute:
        command: $HOME/.local/share/lutris/runtime/winetricks/winetricks -q vcrun2019 dotnet48 d3dcompiler_43 d3dx9
        env:
            WINEPREFIX: $GAMEDIR/../../compatdata/22380/pfx

